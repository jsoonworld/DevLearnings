# IAM의 필요성

아래 사진은 기본적인 아키텍처? 다이어그램입니다.
![](https://velog.velcdn.com/images/harperkwon/post/c3319169-eaeb-46c0-aee2-dff2b0310a5f/image.png)



가정: 우리는 서버 멤버에 관한 정보를 관리하는 어플리케이션을 만들었고 AWS를 활용하는 상황

![](https://velog.velcdn.com/images/harperkwon/post/2b35bb20-cfb2-49b1-b43e-2fce04959009/image.png)


위 다이어그램을 보면 접근 제어와 자격 증명 관리가 필요한 여러 곳(`키 모양이 있는 곳`)을 확인할 수 있죠!

첫 번째는 사용자가 멤버 목록 애플리케이션에 로그인하고 사용하는 방법을 관리해야 합니다. 사용자가 앱에 로그인하기 위해 유효한 자격 증명, 예를 들어 사용자 이름과 비밀번호를 필요로 할 수 있습니다. 이것이 애플리케이션 수준에서의 접근 관리입니다. 

그리고 멤버 목록 애플리케이션을 호스팅하는 서비스 Amazon EC2에 의해 가상 머신에서 실행되는 코드는 멤버의 이미지와 같은 데이터를 읽고 쓰기 위해 객체 저장 서비스 Amazon S3에 API 호출을 해야 한다는 사실이 있습니다. 그런데 여기서 중요한 것은 Amazon EC2와 Amazon S3 모두 이 계정에 기존 리소스가 있다 하더라도 EC2 인스턴스에서 실행되는 코드가 S3에 API 호출을 자동으로 허용된다는 의미는 아닙니다. 

실제로 AWS에서 모든 API 호출은 리소스가 동일한 계정에 속해 있든 아니든 서명되고 인증되어야 합니다. Amazon EC2 인스턴스에서 실행되는 애플리케이션 코드는 이 서명된 API 호출을 Amazon S3에 할 수 있는 자격 증명에 접근할 필요가 있습니다. 그래서 자격 증명과 접근 관리가 필요한 또 다른 장소입니다. 

# 고민해보기

한 걸음 더 나아가 보겠습니다. 이 아키텍처를 어떻게 구축할 것인가요? 로그인을 통해 AWS 계정에 접근할 필요가 있습니다. 이 AWS 계정 내의 당신의 신원은 이 네트워크를 생성하고 EC2 인스턴스를 시작하며 AWS에서 솔루션을 호스트하고 실행할 리소스를 생성하는 것과 같은 작업을 할 수 있는 권한이 필요합니다. 또 다른 자격 증명이 필요한 곳입니다.

루트 사용자는 이러한 권한을 가지고 있지만, AWS 리소스를 관리하기 위해 루트 사용자를 사용하고 싶지는 않을 것입니다. 그리고 이 애플리케이션을 만들거나 구축하는 것이 당신 혼자만이 아닐 것이라고 가정해 봅시다.(**like 앱잼 서버 메이트**) 한AWS 계정 내에서 솔루션을 구축하고 지원할 필요가 있는 많은 사람들이 있을 가능성이 높습니다. 아키텍처의 다른 부분을 담당할 책임이 있는 다양한 그룹의 사람들이 있을 것입니다. 코드를 작성하고 배포할 사람들은 소프트웨어 개발자일 수 있고, 예를 들어 네트워크에 변경을 가하는 사람들은 다른 그룹일 것입니다. AWS 계정에 접근이 필요한 모든 사람에게 루트 사용자 자격 증명을 주어서는 안 되며, 대신 각각의 로그인하는 사람에게 고유한 자격 증명을 부여해야 합니다. 이때 AWS 신원 및 접근 관리 서비스가 사용됩니다.

![](https://velog.velcdn.com/images/harperkwon/post/c692f20c-24b9-448c-b763-4155be742b4f/image.png)


접근 및 자격 증명 관리가 필요한 세 곳을 확인했습니다. AWS 신원 및 접근 관리 또는 IAM은 다이어그램의 이 두 곳(`초록색 체크된 박스`)을 관리하는 데 도움이 될 수 있습니다. AWS IAM은 AWS 계정에 대한 로그인 자격 증명과 권한을 관리하며, AWS 서비스에 대한 API 호출을 서명하는 데 사용되는 자격 증명도 관리할 수 있습니다.

![](https://velog.velcdn.com/images/harperkwon/post/534b2d41-b58b-4b87-b9d6-a94cec8bf095/image.png)


 그러나 IAM은 애플리케이션 수준(`핑크색 X 박스`)의 접근 관리를 담당하지는 않습니다. 이 인스턴스에서 실행되는 코드는 애플리케이션 자체에 사용자를 인증하는 별도의 적절한 메커니즘을 사용할 것입니다, IAM은 사용하지 않습니다. 이제 그럼 AWS 계정 수준에서 시작해 보겠습니다. IAM을 사용하면 사용자를 생성할 수 있고, 당신의 AWS 계정에 접근이 필요한 각 개인은 고유한 IAM 사용자를 갖게 됩니다. 필요한 모든 사람에게 사용자를 생성함으로써 인증을 처리합니다. 

(세미나에서 배운 인증, 인가를 AWS에 적용해서 복습해 보자면!?)

![](https://velog.velcdn.com/images/harperkwon/post/fa1fa8f3-a5c9-47f3-b2c2-b8268edc04de/image.png)


인증이란 그들이 자신이라고 주장하는 사람이 맞는지, 로그인을 할 수 있는 적절한 자격 증명을 가졌는지를 확인하는 것입니다. 인가는? 로그인을 하고 당신이 주장하는 사람이 맞다고 인증되었다고 가정합시다. 이제 Amazon EC2 인스턴스를 생성하는 것과 같은 AWS 리소스를 생성하고 관리하고 싶어합니다. 확실히, 당신은 로그인했지만 그 작업을 완료할 수 있는 적절한 권한을 가지고 있습니까? 권한이 당신이 할 수 있거나 할 수 없는 것을 제어한다는 아이디어가 인가입니다. EC2 인스턴스를 시작할 권한이 있습니까? IAM 사용자는 인증을 처리하며, IAM 정책을 사용자에게 연결하여 AWS 계정 내 특정 작업에 대한 허용 또는 거부 권한을 부여함으로써 인가를 처리할 수 있습니다. 여기에서 말하는 '작업'은 AWS API 호출을 의미합니다!

# IAM 정책:

- 행동을 취할 권한을 부여하거나 거부합니다.
- 행동은 AWS API 호출입니다.
- 정책을 AWS 신원에 첨부합니다.

```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:*",
      "Resource": "<Amazon Resource Name here>",
      "Condition": {
        "<Conditions here>"
      }
    }
  ]
}
```

AWS의 모든 것은 API 호출입니다. IAM 정책은 JSON 기반 문서입니다. 한 예를 살펴보겠습니다. 위 IAM 정책 문서에는 해당 정체성에 연결된 EC2 관련 작업을 수행할 수 있는 권한이 포함되어 있습니다. IAM 정책의 구조에는 허용 또는 거부인 효과가 있습니다. 그리고 이 경우에는 ec2:*가 있으며, 모든 EC2 관련 작업을 포함합니다. 예를 들어, 이 작업을 인스턴스 실행으로 제한할 수 있습니다. 그러면 이 정책이 연결된 사용자는 EC2 인스턴스를 실행할 수 있지만 다른 EC2 관련 작업은 수행할 수 없습니다. IAM을 사용하면 이런 방식으로 권한을 매우 세밀하게 관리할 수 있습니다.

![](https://velog.velcdn.com/images/harperkwon/post/5c7af063-32c5-4f9a-9e9c-d886bdc3d47b/image.png)


이 예제를 계속하면, 작업이 허용되는 AWS 리소스를 제한할 수 있는 리소스를 보게 됩니다. 정책에 조건을 포함하여 작업을 더 제한할 수도 있습니다. IAM 정책은 그룹에도 연결될 수 있습니다. IAM 그룹은 매우 간단하게는 IAM 사용자의 그룹입니다. 정책을 특정 사용자나 그룹에 연결할 수 있습니다. 그룹에 정책을 연결하면 해당 그룹의 모든 사용자가 권한을 상속받게 됩니다. 우리는 최선의 관행으로서 사용자를 그룹으로 조직하고 가능한 개별 사용자 대신 그룹에 권한을 할당할 것을 권장합니다. 이는 사람들이 34기 서버에서의 역할을 변경하거나 여러 사용자에게 권한이 적용되거나 취소될 필요가 있을 때 관리가 쉬워지기 때문입니다. 또 다른 최선의 관행은 AWS 계정을 생성할 때 루트 사용자에게 `MFA`를 설정하고 관리자 권한을 가진 IAM 사용자를 생성한 다음 루트 사용자에서 로그아웃하고 방금 생성한 IAM 사용자로 로그인하는 것입니다. 이를 제안하는 이유는 루트 사용자에게는 정책을 적용할 수 없지만 IAM 사용자에게는 적용할 수 있기 때문입니다. 

- What is MFA? & 권씨는 어떻게 사용하나?
    
    ## 공식 문서
    
    https://aws.amazon.com/ko/blogs/tech/all-for-mfa-in-aws-environment/
    
    # 1. AWS id/password 입력
    
    ![](https://velog.velcdn.com/images/harperkwon/post/81334d04-e6a0-4bd9-8c90-1a2a6ce7bad1/image.png)

    
    ![](https://velog.velcdn.com/images/harperkwon/post/f84431f0-df79-4b2e-8c8d-e7586429afd4/image.png)

    
    # 2. MFA 어플 접속 (저는 구글 사용합니다.)
    
    ![](https://velog.velcdn.com/images/harperkwon/post/4ecb5858-b2d8-41d8-b431-7cef578468be/image.png)

![](https://velog.velcdn.com/images/harperkwon/post/e60c8103-dc2a-45e0-92aa-ea1e7bff0fe7/image.jpg)

![](https://velog.velcdn.com/images/harperkwon/post/22e7ef75-7d04-4009-94bc-99f00e67e138/image.jpg)


 다시 돌아와서,,
 
 
![](https://velog.velcdn.com/images/harperkwon/post/72fc945f-a12a-4940-b50d-f44868466a50/image.png)


이제 IAM 사용자, 그룹 및 정책에 대해 설명했으니, 우리 애플리케이션에 필요한 접근 관리 부분을 다뤘습니다. 그러나 저 부분(`노란 물음표 박스`)은 어떨까요? EC2 인스턴스는 서버 사람들의 이미지를 읽고 쓰기 위해  S3에 서명된 API 호출을 할 수 있는 자격 증명이 필요합니다. EC2에서 실행되는 애플리케이션에 사용할 사용자 이름과 비밀번호가 있는 IAM 사용자를 만들 것을 제안하는 것입니까? 아닙니다, 그렇지 않습니다. 이때 역할 기반 접근이 등장합니다.

```json
자자 이제, 역할 기반 접근에 대한 내용까지 들어가면

SOLID_SRP 위반!
(SRP- 하나의 클래스는 하나의 역할.. 하나의 아티클은,… ㅎ)
```

그렇담 SRP도 지켰겠다

이제 지금까지 알아본 내용들에 대해서 복습하고 정리해 보는 시간을 가져봅시다!

## IAM이란?

IAM은 AWS 계정 및 리소스에 대한 액세스를 관리할 수 있는 웹 서비스입니다. 또한, AWS 계정 내에서 누가 무엇을 허용하는지(인증), 누가 무엇을 AWS 리소스를 사용하고 작업할 수 있는지(권한 부여)에 대한 중앙 집중식 보기를 제공하며, IAM을 사용하면 액세스 키나 비밀번호를 공유하지 않고도 AWS 계정 및 리소스에 대한 액세스를 공유할 수 있습니다. 또한 계정에서 작업하는 사람들에게 세분화된 액세스 권한을 제공하여 사람과 서비스가 필요한 리소스에 대한 권한만 갖도록 할 수도 있습니다. 예를 들어, AWS 계정의 사용자에게 특정 AWS 서비스에 대한 읽기 전용 액세스 권한을 제공하려면 해당 서비스에서 액세스할 수 있는 작업과 리소스를 세밀하게 선택할 수 있습니다.

## IAM 기능 알아보기

AWS 계정 내에서 액세스를 제어하고 ID를 관리하는 데 도움을 주기 위해 IAM은 보안을 보장하는 다양한 기능을 제공합니다.

- IAM은 특정 리전에 국한되지 않고 전 세계적으로 적용됩니다. 즉, AWS 관리 콘솔에서 어느 리전에서나 IAM 구성을 확인하고 사용할 수 있습니다.
- IAM은 기본적으로 많은 AWS 서비스와 통합되어 있습니다.
- IAM에서 비밀번호 정책을 설정하여 복잡성 요구 사항과 사용자에 대한 필수 로테이션 기간을 지정할 수 있습니다.
- IAM은 MFA를 지원합니다.
- IAM은 ID 페더레이션을 지원하므로, 기업 네트워크나 인터넷 ID 공급자와 같이 이미 다른 곳에 비밀번호를 가지고 있는 사용자가 AWS 계정에 임시 액세스 권한을 얻을 수 있습니다.
- 모든 AWS 고객은 IAM을 사용할 수 있으며, 이 서비스는 추가 비용 없이 제공됩니다.

## IAM 사용자란 무엇인가요?

IAM 사용자는 AWS와 상호 작용하는 사람 또는 서비스를 나타냅니다. AWS 계정 내에서 사용자를 정의합니다. 그리고 해당 사용자가 수행한 모든 활동은 계정으로 청구됩니다. 사용자를 생성하면 해당 사용자가 로그인하여 계정 내의 AWS 리소스에 액세스할 수 있으며, 필요에 따라 계정에 사용자를 더 추가할 수도 있습니다. 예를 들어, 춘팔이(고모네 강아지) 사진 애플리케이션의 경우, 애플리케이션을 작업하는 사람들에 해당하는 개별 사용자를 AWS 계정에 생성할 수 있습니다. 각 사용자는 고유한 로그인 자격 증명을 가져야 합니다. 사용자에게 각자의 로그인 자격 증명을 제공하면 자격 증명이 공유되는 것을 방지할 수 있습니다

## IAM 사용자 자격 증명

IAM 사용자는 이름과 자격 증명 집합으로 구성됩니다. 사용자를 만들 때 사용자에게 제공하도록 선택할 수 있습니다:

- AWS 관리 콘솔에 대한 액세스
- AWS CLI(AWS 명령줄 인터페이스) 및 AWS API(AWS 애플리케이션 프로그래밍 인터페이스)에 대한 프로그래밍 방식 액세스

AWS 관리 콘솔에 액세스하려면 사용자에게 사용자 이름과 비밀번호를 제공합니다. 프로그래밍 방식의 액세스를 위해 AWS는 AWS CLI 및 AWS API와 함께 사용할 수 있는 액세스 키 집합을 생성합니다. IAM 사용자 자격 증명은 관리자가 강제로 교체하지 않는 한 사용자에게 영구적으로 유지된다는 점에서 영구적인 것으로 간주되며, IAM 사용자를 생성할 때 사용자 수준에서 직접 권한을 부여할 수 있는 옵션이 있으며, 사용자가 한 명 또는 몇 명만 있는 경우에는 이 방법이 좋은 아이디어처럼 보일 수 있습니다. 그러나 AWS에서 솔루션을 구축하는 데 도움을 주는 사용자 수가 증가하면 권한을 따라잡기가 더 복잡해집니다. 예를 들어, AWS 계정에 3,000명의 사용자가 있는 경우 액세스 관리가 어려워지고 누가 어떤 리소스에 대해 어떤 작업을 수행할 수 있는지 최상위 수준에서 파악하는 것이 불가능합니다. 이때 등장하는 것이 IAM 그룹!

## IAM 그룹이란 무엇인가요?

IAM 그룹은 사용자들의 집합입니다. 그룹의 모든 사용자는 그룹에 할당된 권한을 상속받습니다. 따라서 여러 사용자에게 한 번에 쉽게 권한을 부여할 수 있습니다. AWS 계정의 사용자에 대한 권한을 보다 편리하고 확장 가능한 방식으로 관리할 수 있습니다. 빌드하려는 애플리케이션이 있고 하나의 계정으로 여러 사용자가 애플리케이션에서 작업하는 경우, 이러한 사용자를 직무별로 구성할 수 있습니다. 세미나 뒤풀이 예약 관리자, 새벽 서버 디코 수문장 및 디코 지킴이별로 IAM 그룹을 구성할 수 있습니다. 그러면 모든 IAM 사용자를 역할별로 해당 그룹에 배치할 수 있습니다. 이렇게 하면 솝트 서버 내에서 누가 어떤 권한을 가지고 있는지 더 잘 파악할 수 있고 새로운 사람이 솝트 서버에 합류, 탈퇴 및 역할을 변경할 때 더 쉽게 확장할 수 있습니다. 다음 예를 고려해 보면 어떨지?.

- 35기 YB 서버가 애플리케이션을 지원하기 위해 AWS 계정에 가입합니다. 새 사용자를 생성하고 35 YB 서버 그룹에 추가하기만 하면 어떤 권한이 필요한지 고민할 필요가 없습니다.
- 35기 YB 서버가 파트를 변경하여 기획이 된 경우. 사용자의 권한을 직접 편집하는 대신 이전 그룹에서 해당 사용자를 제거하고 이미 올바른 수준의 액세스 권한이 있는 새 그룹에 추가할 수 있습니다.

그룹의 다음 기능에 유의하세요.

- 그룹에는 많은 사용자가 있을 수 있습니다.
- 사용자는 여러 그룹에 소속될 수 있습니다.
- 그룹은 그룹에 속할 수 없습니다.

루트 사용자는 기본적으로 AWS 계정 내의 모든 리소스에 대해 모든 작업을 수행할 수 있습니다. 이는 새 IAM 사용자, 새 그룹 또는 새 역할을 만드는 것과는 대조적입니다. 새 IAM ID는 명시적으로 권한을 부여하기 전까지는 기본적으로 AWS 계정 내에서 어떤 작업도 수행할 수 없으며, IAM에서 권한을 부여하는 방법은 IAM 정책을 사용하는 것입니다.

## IAM 정책이란 무엇인가요?

액세스를 관리하고 AWS 서비스 및 리소스에 대한 권한을 제공하기 위해, IAM 정책을 생성하고 이를 IAM 사용자, 그룹 및 역할에 연결합니다. 사용자나 역할이 요청을 할 때마다 AWS는 해당 사용자나 역할과 관련된 정책을 평가합니다. 예를 들어, 34기 YB 서버에 속한 서버인이 AWS 서비스에 요청을 하는 경우, AWS는 34기 YB 서버 그룹에 첨부된 모든 정책과 34기 YB 서버 사용자에게 첨부된 모든 정책을 평가하여 요청을 허용할지 거부할지 결정합니다.

## IAM 정책 예시

대부분의 정책은 여러 정책 요소가 포함된 JSON 문서로 AWS에 저장됩니다. 다음 예시를 통해 IAM ID 기반 정책을 통해 관리자 액세스 권한을 제공하는 것이 어떤 모습인지 살펴봅시다.

```json
{

"Version": "2024-06-05",    

     "Statement": [{        
          "Effect": "Allow",        

          "Action": "*",        

          "Resource": "*"     

     }]

}
```

이 정책에는 네 가지 주요 JSON 요소가 있습니다: 버전, 효과, 작업 및 리소스입니다.

- **Version** 요소는 정책 언어의 버전을 정의합니다. 이 요소는 AWS가 정책을 처리하는 데 필요한 언어 구문 규칙을 지정합니다. 사용 가능한 모든 정책 기능을 사용하려면 "버전"을 포함하세요: "2024-06-05"을 모든 정책의 "Statement" 요소 앞에 추가하세요.
- **Effect** 요소는 문이 액세스를 허용할지 거부할지를 지정합니다. 이 정책에서 효과는 "허용"이며, 이는 특정 리소스에 대한 액세스를 제공한다는 의미입니다.
- **Action** 요소는 허용하거나 거부해야 하는 작업의 유형을 설명합니다. 위 정책에서 액션은 "*"입니다. 이를 와일드카드라고 하며, AWS 계정 내의 모든 작업을 상징하는 데 사용됩니다.
- **리소스** 요소는 정책 문이 적용되는 개체를 지정합니다. 위의 정책 예제에서 리소스도 와일드카드 "*"입니다. 이는 AWS 콘솔 내의 모든 리소스를 나타냅니다.

이 모든 정보를 종합하면 AWS 계정 내의 모든 리소스에 대한 모든 작업을 수행할 수 있는 정책을 갖게 됩니다. 이를 `관리자 정책`이라고 합니다.

좀 더 세분화된 IAM 정책의 또 다른 예를 살펴보겠습니다.

```json
{"Version": "2024-06-05",    

     "Statement": [{        

          "Effect": "Allow",        

          "Action": [            

               "iam: ChangePassword",            

               "iam: GetUser"            

               ]        

          "Resource": 

"arn:aws:iam::123456789012:user/${aws:username}"    

     }]

}
```

JSON을 살펴보면, 이 정책은 IAM 사용자가 자신의 IAM 비밀버호(iam:ChangePassword)를 변경하고자 자신의 사용자에 대한 정보(iam:GetUser)를 가져올 수 있도록 허용하고 있음을 알 수 있습니다. 리소스가 변수 치환 ${aws:사용자 이름}으로 엑세스를 제한하기 때문에 자신의 자격 증명에 대한 엑세스만 허용합니다.

## 정책 구조 이해

정책을 만들 때는 정책 문 안에 다음 각 요소를 포함해야 합니다.

| 요소 | 설명 | 필수 | 예시 |
| --- | --- | --- | --- |
| 효과 | 문이 허용 또는 명시적 거부를 초래할지 여부를 지정합니다 | ✔ | "효과": "거부" |
| Action | 허용 또는 거부할 특정 작업을 설명합니다 | ✔ | "액션": "iam:CreateUser" |
| Resource | 문이 적용되는 개체를 지정합니다 | ✔ | "Resource": "arn:aws:iam::account-ID-without-hyphens:user/Bob" |

**리소스**

- [*외부 사이트: IAM이란 무엇인가요?*](https://docs.amazonaws.cn/en_us/IAM/latest/UserGuide/introduction.html)
- [*외부 사이트: AWS IAM ID*](https://docs.amazonaws.cn/en_us/IAM/latest/UserGuide/id.html)
- [*외부 사이트: AWS IAM을 통한 액세스 관리*](https://docs.amazonaws.cn/en_us/IAM/latest/UserGuide/access.html)
